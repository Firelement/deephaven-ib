<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <link rel="shortcut icon" href="../_static/favicon.svg"/><meta name="generator" content="sphinx-4.4.0, furo 2022.01.02"/>
        <title>deephaven - deephaven_ib documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">deephaven_ib  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">deephaven_ib  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules.html">Python Modules</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../code/deephaven_ib.html">deephaven_ib</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven_ib.time.html">time</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../code/deephaven.html">deephaven</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.AggregationFactory.html">AggregationFactory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.Calendars.html">Calendars</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.ConsumeCdc.html">ConsumeCdc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.ConsumeKafka.html">ConsumeKafka</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.DateTimeUtils.html">DateTimeUtils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.MovingAverages.html">MovingAverages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.ParquetTools.html">ParquetTools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.PerformanceQueries.html">PerformanceQueries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.PerformanceTools.html">PerformanceTools</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../code/deephaven.Plot.html">Plot</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.Plot.ColorMaps.html">ColorMaps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.Plot.figure_wrapper.html">figure_wrapper</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.ProduceKafka.html">ProduceKafka</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.ResolveTools.html">ResolveTools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.TableLoggers.html">TableLoggers</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../code/deephaven.TableManipulation.html">TableManipulation</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.TableManipulation.WindowCheck.html">WindowCheck</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.TableTools.html">TableTools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.Types.html">Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.conversion_utils.html">conversion_utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.csv.html">csv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.filter.html">filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.java_to_python.html">java_to_python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.jvm_init.html">jvm_init</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../code/deephaven.lang.html">lang</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.lang.ListBasedSet.html">ListBasedSet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.lang.analyzer.html">analyzer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.lang.arrays.html">arrays</a></li>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.lang.constants.html">constants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.lang.tools.html">tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.lang.transformer.html">transformer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.lang.vectorize_simple.html">vectorize_simple</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../code/deephaven.learn.html">learn</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.learn.gather.html">gather</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.python_to_java.html">python_to_java</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code/deephaven.start_jvm.html">start_jvm</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../code/deephaven.tutorials.html">tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../code/deephaven.tutorials.crypto_trades.html">crypto_trades</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../code/jpy.html">jpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/ibapi.contract.html">ibapi.contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code/ibapi.order.html">ibapi.order</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../py-modindex.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for deephaven</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Copyright (c) 2016-2021 Deephaven Data Labs and Patent Pending</span>
<span class="c1">#</span>

<span class="sd">"""</span>
<span class="sd">Main Deephaven python module.</span>

<span class="sd">For convenient usage in the python console, the main sub-packages of deephaven have been imported here with aliases:</span>

<span class="sd">* Calendars imported as cals</span>

<span class="sd">* AggregationFactory imported as af</span>

<span class="sd">* DateTimeUtils imported as dtu</span>

<span class="sd">* MovingAverages imported as mavg</span>

<span class="sd">* Plot imported as plt</span>

<span class="sd">* ParquetTools imported as pt</span>

<span class="sd">* TableTools imported as ttools *(`tt` is frequently used for time table)*</span>

<span class="sd">Additionally, the following methods have been imported into the main deephaven namespace:</span>

<span class="sd">* from Plot import figure_wrapper as figw</span>

<span class="sd">* from java_to_python import tableToDataFrame, columnToNumpyArray, convertJavaArray</span>

<span class="sd">* from python_to_java import dataFrameToTable, createTableFromData</span>

<span class="sd">* from conversion_utils import convertToJavaArray, convertToJavaList, convertToJavaArrayList,</span>
<span class="sd">       convertToJavaHashSet, convertToJavaHashMap</span>

<span class="sd">* from TableManipulation import Aggregation, ColumnName, ColumnRenderersBuilder, DistinctFormatter,</span>
<span class="sd">       DownsampledWhereFilter, DynamicTableWriter, LayoutHintBuilder,  </span>
<span class="sd">       Replayer, SmartKey, SortColumn, TotalsTableBuilder, WindowCheck</span>

<span class="sd">For ease of namespace population in a python console, consider::</span>

<span class="sd">&gt;&gt;&gt; from deephaven import *  # this will import the submodules into the main namespace</span>
<span class="sd">&gt;&gt;&gt; print(dir())  # this will display the contents of the main namespace</span>
<span class="sd">&gt;&gt;&gt; help(plt)  # will display the help entry (doc strings) for the deephaven.plot module</span>
<span class="sd">&gt;&gt;&gt; help(columnToNumpyArray)  # will display the help entry for the columnToNumpyArray method</span>
<span class="sd">"""</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"PythonFunction"</span><span class="p">,</span> <span class="s2">"PythonListenerAdapter"</span><span class="p">,</span> <span class="s2">"PythonShiftAwareListenerAdapter"</span><span class="p">,</span>
    <span class="s2">"TableListenerHandle"</span><span class="p">,</span> <span class="s2">"listen"</span><span class="p">,</span> <span class="s2">"doLocked"</span><span class="p">,</span>  <span class="c1"># from here</span>

    <span class="s2">"convertJavaArray"</span><span class="p">,</span> <span class="s2">"tableToDataFrame"</span><span class="p">,</span> <span class="s2">"columnToNumpyArray"</span><span class="p">,</span>  <span class="c1"># from java_to_python</span>

    <span class="s2">"createTableFromData"</span><span class="p">,</span> <span class="s2">"dataFrameToTable"</span><span class="p">,</span>  <span class="c1"># from python_to_java</span>

    <span class="s2">"convertToJavaArray"</span><span class="p">,</span> <span class="s2">"convertToJavaList"</span><span class="p">,</span> <span class="s2">"convertToJavaArrayList"</span><span class="p">,</span> <span class="s2">"convertToJavaHashSet"</span><span class="p">,</span>
    <span class="s2">"convertToJavaHashMap"</span><span class="p">,</span>  <span class="c1"># from conversion_utils</span>

    <span class="s1">'Aggregation'</span><span class="p">,</span> <span class="s1">'ColumnName'</span><span class="p">,</span> <span class="s1">'ColumnRenderersBuilder'</span><span class="p">,</span> <span class="s1">'DistinctFormatter'</span><span class="p">,</span> <span class="s1">'DownsampledWhereFilter'</span><span class="p">,</span> <span class="s1">'DynamicTableWriter'</span><span class="p">,</span>
    <span class="s1">'LayoutHintBuilder'</span><span class="p">,</span> <span class="s1">'Replayer'</span><span class="p">,</span> <span class="s1">'SmartKey'</span><span class="p">,</span> <span class="s1">'SortColumn'</span><span class="p">,</span> <span class="s1">'TotalsTableBuilder'</span><span class="p">,</span> <span class="s1">'WindowCheck'</span><span class="p">,</span>  <span class="c1"># from TableManipulation</span>

    <span class="s2">"cals"</span><span class="p">,</span> <span class="s2">"af"</span><span class="p">,</span> <span class="s2">"dtu"</span><span class="p">,</span> <span class="s2">"figw"</span><span class="p">,</span> <span class="s2">"mavg"</span><span class="p">,</span> <span class="s2">"plt"</span><span class="p">,</span> <span class="s2">"pt"</span><span class="p">,</span> <span class="s2">"ttools"</span><span class="p">,</span> <span class="s2">"tloggers"</span><span class="p">,</span>  <span class="c1"># subpackages with abbreviated names</span>

    <span class="s2">"read_csv"</span><span class="p">,</span> <span class="s2">"write_csv"</span> <span class="c1"># from csv</span>
<span class="p">]</span>


<span class="kn">import</span> <span class="nn">jpy</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">base64</span>  <span class="c1"># builtin</span>
<span class="kn">import</span> <span class="nn">inspect</span>

<span class="kn">import</span> <span class="nn">wrapt</span>  <span class="c1"># dependencies</span>
<span class="kn">import</span> <span class="nn">dill</span>

<span class="kn">from</span> <span class="nn">.TableManipulation</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">.java_to_python</span> <span class="kn">import</span> <span class="n">convertJavaArray</span><span class="p">,</span> <span class="n">tableToDataFrame</span><span class="p">,</span> <span class="n">columnToNumpyArray</span>
<span class="kn">from</span> <span class="nn">.python_to_java</span> <span class="kn">import</span> <span class="n">dataFrameToTable</span><span class="p">,</span> <span class="n">createTableFromData</span>
<span class="kn">from</span> <span class="nn">.conversion_utils</span> <span class="kn">import</span> <span class="n">convertToJavaArray</span><span class="p">,</span> <span class="n">convertToJavaList</span><span class="p">,</span> <span class="n">convertToJavaArrayList</span><span class="p">,</span> <span class="n">convertToJavaHashSet</span><span class="p">,</span> \
    <span class="n">convertToJavaHashMap</span><span class="p">,</span> <span class="n">getJavaClassObject</span>


<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">Calendars</span> <span class="k">as</span> <span class="n">cals</span><span class="p">,</span> \
    <span class="n">AggregationFactory</span> <span class="k">as</span> <span class="n">af</span><span class="p">,</span> \
    <span class="n">DateTimeUtils</span> <span class="k">as</span> <span class="n">dtu</span><span class="p">,</span> \
    <span class="n">MovingAverages</span> <span class="k">as</span> <span class="n">mavg</span><span class="p">,</span> \
    <span class="n">ConsumeKafka</span> <span class="k">as</span> <span class="n">ck</span><span class="p">,</span> \
    <span class="n">ProduceKafka</span> <span class="k">as</span> <span class="n">pk</span><span class="p">,</span> \
    <span class="n">Plot</span> <span class="k">as</span> <span class="n">plt</span><span class="p">,</span> \
    <span class="n">ParquetTools</span> <span class="k">as</span> <span class="n">pt</span><span class="p">,</span> \
    <span class="n">TableTools</span> <span class="k">as</span> <span class="n">ttools</span><span class="p">,</span> \
    <span class="n">TableLoggers</span> <span class="k">as</span> <span class="n">tloggers</span><span class="p">,</span> \
    <span class="n">Types</span> <span class="k">as</span> <span class="n">dh</span><span class="p">,</span> \
    <span class="nb">filter</span> <span class="k">as</span> <span class="n">_filter</span>

<span class="kn">from</span> <span class="nn">.Plot</span> <span class="kn">import</span> <span class="n">figure_wrapper</span> <span class="k">as</span> <span class="n">figw</span>

<span class="kn">from</span> <span class="nn">.csv</span> <span class="kn">import</span> <span class="n">read</span> <span class="k">as</span> <span class="n">read_csv</span>
<span class="kn">from</span> <span class="nn">.csv</span> <span class="kn">import</span> <span class="n">write</span> <span class="k">as</span> <span class="n">write_csv</span>

<span class="c1"># NB: this must be defined BEFORE importing .jvm_init or .start_jvm (circular import)</span>
<span class="k">def</span> <span class="nf">initialize</span><span class="p">():</span>
    <span class="n">__initializer__</span><span class="p">(</span><span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.configuration.Configuration"</span><span class="p">),</span> <span class="n">Config</span><span class="p">)</span>
    <span class="n">__initializer__</span><span class="p">(</span><span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.engine.util.PickledResult"</span><span class="p">),</span> <span class="n">PickledResult</span><span class="p">)</span>
    <span class="n">__initializer__</span><span class="p">(</span><span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.integrations.python.PythonShiftObliviousListenerAdapter"</span><span class="p">),</span> <span class="n">PythonListenerAdapter</span><span class="p">)</span>
    <span class="n">__initializer__</span><span class="p">(</span><span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.integrations.python.PythonFunction"</span><span class="p">),</span> <span class="n">PythonFunction</span><span class="p">)</span>

    <span class="c1"># ensure that all the symbols are called and reimport the broken symbols</span>
    <span class="n">cals</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">af</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">dtu</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">dh</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">ck</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">pk</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">mavg</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">figw</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">pt</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">ttools</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">tloggers</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">csv</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="n">_filter</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>

    <span class="kn">import</span> <span class="nn">deephaven.TableManipulation</span>
    <span class="n">deephaven</span><span class="o">.</span><span class="n">TableManipulation</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>
    <span class="k">global</span> <span class="n">Aggregation</span><span class="p">,</span> <span class="n">ColumnName</span><span class="p">,</span> <span class="n">ColumnRenderersBuilder</span><span class="p">,</span> <span class="n">DistinctFormatter</span><span class="p">,</span> <span class="n">DownsampledWhereFilter</span><span class="p">,</span> <span class="n">DynamicTableWriter</span><span class="p">,</span> \
        <span class="n">LayoutHintBuilder</span><span class="p">,</span> <span class="n">Replayer</span><span class="p">,</span> <span class="n">SmartKey</span><span class="p">,</span> <span class="n">SortColumn</span><span class="p">,</span> <span class="n">TotalsTableBuilder</span>
    <span class="kn">from</span> <span class="nn">deephaven.TableManipulation</span> <span class="kn">import</span> <span class="n">Aggregation</span><span class="p">,</span> <span class="n">ColumnName</span><span class="p">,</span> <span class="n">ColumnRenderersBuilder</span><span class="p">,</span> <span class="n">DistinctFormatter</span><span class="p">,</span> \
        <span class="n">DownsampledWhereFilter</span><span class="p">,</span> <span class="n">DynamicTableWriter</span><span class="p">,</span> <span class="n">LayoutHintBuilder</span><span class="p">,</span> <span class="n">Replayer</span><span class="p">,</span> <span class="n">SmartKey</span><span class="p">,</span> \
        <span class="n">SortColumn</span><span class="p">,</span> <span class="n">TotalsTableBuilder</span>

    <span class="n">WindowCheck</span><span class="o">.</span><span class="n">_defineSymbols</span><span class="p">()</span>

    <span class="k">global</span> <span class="n">Figure</span><span class="p">,</span> <span class="n">PlottingConvenience</span>
    <span class="n">Figure</span> <span class="o">=</span> <span class="n">FigureUnsupported</span>
    <span class="n">PlottingConvenience</span> <span class="o">=</span> <span class="n">FigureUnsupported</span>

<span class="kn">from</span> <span class="nn">.jvm_init</span> <span class="kn">import</span> <span class="n">jvm_init</span>
<span class="kn">from</span> <span class="nn">.start_jvm</span> <span class="kn">import</span> <span class="n">start_jvm</span>


<span class="n">Figure</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># variable for initialization</span>
<span class="n">PlottingConvenience</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># variable for initialization</span>


<span class="k">def</span> <span class="nf">verifyPicklingCompatibility</span><span class="p">(</span><span class="n">otherPythonVersion</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Check a provided python version string versus the present instance string for pickling safety.</span>

<span class="sd">    :param otherPythonVersion: other version string</span>
<span class="sd">    :return: True is safe, False otherwise</span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">otherPythonVersion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">sPyVer</span> <span class="o">=</span> <span class="n">otherPythonVersion</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sPyVer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sPyVer</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">sPyVer</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># We need both major and minor agreement for pickling compatibility</span>
        <span class="k">return</span> <span class="n">major</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">minor</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">class</span> <span class="nc">FigureUnsupported</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Can not create a plot outside of the console."</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">__initializer__</span><span class="p">(</span><span class="n">jtype</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">jtype</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>


<span class="k">def</span> <span class="nf">PickledResult</span><span class="p">(</span><span class="n">pickled</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.engine.util.PickledResult"</span><span class="p">)(</span><span class="n">pickled</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Config</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.configuration.Configuration"</span><span class="p">)</span><span class="o">.</span><span class="n">getInstance</span><span class="p">()</span>


<div class="viewcode-block" id="PythonListenerAdapter"><a class="viewcode-back" href="../code/deephaven.html#deephaven.PythonListenerAdapter">[docs]</a><span class="k">def</span> <span class="nf">PythonListenerAdapter</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">implementation</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">replayInitialImage</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Constructs the ShiftObliviousInstrumentedListenerAdapter, implemented in Python, and plugs it into the table's</span>
<span class="sd">    listenForUpdates method.</span>

<span class="sd">    :param table: table to which to listen</span>
<span class="sd">    :param implementation: the body of the implementation for the ShiftObliviousInstrumentedListenerAdapter.onUpdate method, and</span>
<span class="sd">      must either be a class with onUpdate method or a callable.</span>
<span class="sd">    :param description: A description for the UpdatePerformanceTracker to append to its entry description.</span>
<span class="sd">    :param retain: Whether a hard reference to this listener should be maintained to prevent it from being collected.</span>
<span class="sd">    :param replayInitialImage: False to only process new rows, ignoring any previously existing rows in the Table;</span>
<span class="sd">      True to process updates for all initial rows in the table PLUS all new row changes.</span>
<span class="sd">    """</span>

    <span class="n">jtype</span> <span class="o">=</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s1">'io.deephaven.integrations.python.PythonShiftObliviousListenerAdapter'</span><span class="p">)</span>
    <span class="n">ListenerInstance</span> <span class="o">=</span> <span class="n">jtype</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">retain</span><span class="p">,</span> <span class="n">implementation</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">listenForUpdates</span><span class="p">(</span><span class="n">ListenerInstance</span><span class="p">,</span> <span class="n">replayInitialImage</span><span class="p">)</span></div>


<div class="viewcode-block" id="PythonShiftAwareListenerAdapter"><a class="viewcode-back" href="../code/deephaven.html#deephaven.PythonShiftAwareListenerAdapter">[docs]</a><span class="k">def</span> <span class="nf">PythonShiftAwareListenerAdapter</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">implementation</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retain</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Constructs the InstrumentedTableUpdateListenerAdapter, implemented in Python, and plugs it into the table's</span>
<span class="sd">    listenForUpdates method.</span>

<span class="sd">    :param table: table to which to listen</span>
<span class="sd">    :param implementation: the body of the implementation for the InstrumentedTableUpdateListenerAdapter.onUpdate method, and</span>
<span class="sd">      must either be a class with onUpdate method or a callable.</span>
<span class="sd">    :param description: A description for the UpdatePerformanceTracker to append to its entry description.</span>
<span class="sd">    :param retain: Whether a hard reference to this listener should be maintained to prevent it from being collected.</span>
<span class="sd">    """</span>

    <span class="n">jtype</span> <span class="o">=</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s1">'io.deephaven.integrations.python.PythonListenerAdapter'</span><span class="p">)</span>
    <span class="n">ListenerInstance</span> <span class="o">=</span> <span class="n">jtype</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">retain</span><span class="p">,</span> <span class="n">implementation</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">listenForUpdates</span><span class="p">(</span><span class="n">ListenerInstance</span><span class="p">)</span></div>


<div class="viewcode-block" id="PythonFunction"><a class="viewcode-back" href="../code/deephaven.html#deephaven.PythonFunction">[docs]</a><span class="k">def</span> <span class="nf">PythonFunction</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">classString</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Constructs a Java Function&lt;PyObject, Object&gt; implementation from the given python function `func`. The proper</span>
<span class="sd">    Java object interpretation for the return of `func` must be provided.</span>

<span class="sd">    :param func: Python callable or class instance with `apply` method (single argument)</span>
<span class="sd">    :param classString: the fully qualified class path of the return for `func`. This is really anticipated to be one</span>
<span class="sd">                        of `java.lang.String`, `double`, 'float`, `long`, `int`, `short`, `byte`, or `boolean`,</span>
<span class="sd">                        and any other value will result in `java.lang.Object` and likely be unusable.</span>
<span class="sd">    :return: io.deephaven.integrations.python.PythonFunction instance, primarily intended for use in PivotWidgetBuilder usage</span>
<span class="sd">    """</span>

    <span class="n">jtype</span> <span class="o">=</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s1">'io.deephaven.integrations.python.PythonFunction'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jtype</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">getJavaClassObject</span><span class="p">(</span><span class="n">classString</span><span class="p">))</span></div>


<div class="viewcode-block" id="TableListenerHandle"><a class="viewcode-back" href="../code/deephaven.html#deephaven.TableListenerHandle">[docs]</a><span class="k">class</span> <span class="nc">TableListenerHandle</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    A handle for a table listener.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">listener</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Creates a new table listener handle.</span>

<span class="sd">        :param t: table being listened to.</span>
<span class="sd">        :param listener: listener object.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listener</span> <span class="o">=</span> <span class="n">listener</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isRegistered</span> <span class="o">=</span> <span class="kc">False</span>


<div class="viewcode-block" id="TableListenerHandle.register"><a class="viewcode-back" href="../code/deephaven.html#deephaven.TableListenerHandle.register">[docs]</a>    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Register the listener with the table and listen for updates.</span>
<span class="sd">        """</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRegistered</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Attempting to register an already registered listener.."</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">listenForUpdates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listener</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">isRegistered</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="TableListenerHandle.deregister"><a class="viewcode-back" href="../code/deephaven.html#deephaven.TableListenerHandle.deregister">[docs]</a>    <span class="k">def</span> <span class="nf">deregister</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Deregister the listener from the table and stop listening for updates.</span>
<span class="sd">        """</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRegistered</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Attempting to deregister an unregistered listener.."</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">removeUpdateListener</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listener</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isRegistered</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<span class="k">def</span> <span class="nf">_nargsListener</span><span class="p">(</span><span class="n">listener</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Returns the number of arguments the listener takes.</span>

<span class="sd">    :param listener: listener</span>
<span class="sd">    :return: number of arguments the listener takes.</span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">listener</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">listener</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">listener</span><span class="p">,</span> <span class="s1">'onUpdate'</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">listener</span><span class="o">.</span><span class="n">onUpdate</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"ShiftObliviousListener is neither callable nor has an 'onUpdate' method"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"2"</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">inspect</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getargspec</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"3"</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Unsupported python version: version=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">))</span>


<div class="viewcode-block" id="listen"><a class="viewcode-back" href="../code/deephaven.html#deephaven.listen">[docs]</a><span class="k">def</span> <span class="nf">listen</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">listener</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ltype</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">,</span> <span class="n">start_listening</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">replay_initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lock_type</span><span class="o">=</span><span class="s2">"shared"</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Listen to table changes.</span>

<span class="sd">    Table change events are processed by listener, which can be either (1) a callable (e.g. function) or</span>
<span class="sd">    (2) an object which provides an "onUpdate" method.</span>
<span class="sd">    In either case, the method must have one of the following signatures.</span>

<span class="sd">    * (added, removed, modified): shift_oblivious or legacy</span>
<span class="sd">    * (isReplay, added, removed, modified): shift_oblivious + replay</span>
<span class="sd">    * (update): shift-aware</span>
<span class="sd">    * (isReplay, update): shift-aware + replay</span>

<span class="sd">    For legacy listeners, added, removed, and modified are the indices of the rows which changed.</span>
<span class="sd">    For shift-aware listeners, update is an object which describes the table update.</span>
<span class="sd">    Listeners which support replaying the initial table snapshot have an additional parameter, inReplay, which is</span>
<span class="sd">    true when replaying the initial snapshot and false during normal updates.</span>

<span class="sd">    See the Deephaven listener documentation for details on processing update events.  This documentation covers the</span>
<span class="sd">    details of the added, removed, and modified row sets; row shift information; as well as the details of how to apply</span>
<span class="sd">    the update object.  It also has examples on how to access current and previous-tick table values.</span>

<span class="sd">    :param t: table to listen to.</span>
<span class="sd">    :param listener: listener to process changes.</span>
<span class="sd">    :param description: description for the UpdatePerformanceTracker to append to the listener's entry description.</span>
<span class="sd">    :param retain: whether a hard reference to this listener should be maintained to prevent it from being collected.</span>
<span class="sd">    :param ltype: listener type.  Valid values are "auto", "legacy", and "shift_aware".  "auto" (default) uses inspection to automatically determine the type of input listener.  "legacy" is for a legacy listener, which takes three (added, removed, modified) or four (isReplay, added, removed, modified) arguments.  "shift_aware" is for a shift-aware listener, which takes one (update) or two (isReplay, update) arguments.</span>
<span class="sd">    :param start_listening: True to create the listener and register the listener with the table.  The listener will see updates.  False to create the listener, but do not register the listener with the table.  The listener will not see updates.</span>
<span class="sd">    :param replay_initial: True to replay the initial table contents to the listener.  False to only listen to new table changes.  To replay the initial image, the listener must support replay.</span>
<span class="sd">    :param lock_type: UGP lock type.  Used when replay_initial=True.  See :func:`doLocked` for valid values.</span>
<span class="sd">    :return: table listener handle.</span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">replay_initial</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start_listening</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unable to create listener.  Inconsistent arguments.  If the initial snapshot is replayed (replay_initial=True), then the listener must be registered to start listening (start_listening=True)."</span><span class="p">)</span>

    <span class="n">nargs</span> <span class="o">=</span> <span class="n">_nargsListener</span><span class="p">(</span><span class="n">listener</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ltype</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ltype</span> <span class="o">==</span> <span class="s2">"auto"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ltype</span> <span class="o">=</span> <span class="s2">"shift_aware"</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">ltype</span> <span class="o">=</span> <span class="s2">"shift_oblivious"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unable to autodetect listener type.  ShiftObliviousListener does not take an expected number of arguments.  args=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nargs</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">ltype</span> <span class="o">==</span> <span class="s2">"shift_oblivious"</span> <span class="ow">or</span> <span class="n">ltype</span> <span class="o">==</span> <span class="s2">"legacy"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">replay_initial</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"ShiftObliviousListener does not support replay: ltype=</span><span class="si">{}</span><span class="s2"> nargs=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">nargs</span><span class="p">))</span>

            <span class="n">ListenerAdapter</span> <span class="o">=</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.integrations.python.PythonShiftObliviousListenerAdapter"</span><span class="p">)</span>
            <span class="n">listener_adapter</span> <span class="o">=</span> <span class="n">ListenerAdapter</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">retain</span><span class="p">,</span> <span class="n">listener</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">ListenerAdapter</span> <span class="o">=</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.integrations.python.PythonReplayShiftObliviousListenerAdapter"</span><span class="p">)</span>
            <span class="n">listener_adapter</span> <span class="o">=</span> <span class="n">ListenerAdapter</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">retain</span><span class="p">,</span> <span class="n">listener</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Legacy listener must take 3 (added, removed, modified) or 4 (isReplay, added, removed, modified) arguments."</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ltype</span> <span class="o">==</span> <span class="s2">"shift_aware"</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">replay_initial</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"ShiftObliviousListener does not support replay: ltype=</span><span class="si">{}</span><span class="s2"> nargs=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ltype</span><span class="p">,</span> <span class="n">nargs</span><span class="p">))</span>

            <span class="n">ListenerAdapter</span> <span class="o">=</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.integrations.python.PythonListenerAdapter"</span><span class="p">)</span>
            <span class="n">listener_adapter</span> <span class="o">=</span> <span class="n">ListenerAdapter</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">retain</span><span class="p">,</span> <span class="n">listener</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ListenerAdapter</span> <span class="o">=</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.integrations.python.PythonReplayListenerAdapter"</span><span class="p">)</span>
            <span class="n">listener_adapter</span> <span class="o">=</span> <span class="n">ListenerAdapter</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">retain</span><span class="p">,</span> <span class="n">listener</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Shift-aware listener must take 1 (update) or 2 (isReplay, update) arguments."</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unsupported listener type: ltype=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ltype</span><span class="p">))</span>

    <span class="n">handle</span> <span class="o">=</span> <span class="n">TableListenerHandle</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">listener_adapter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">replay_initial</span><span class="p">:</span>
            <span class="n">listener_adapter</span><span class="o">.</span><span class="n">replay</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">start_listening</span><span class="p">:</span>
            <span class="n">handle</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">replay_initial</span><span class="p">:</span>
        <span class="n">doLocked</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">lock_type</span><span class="o">=</span><span class="n">lock_type</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">handle</span></div>


<div class="viewcode-block" id="doLocked"><a class="viewcode-back" href="../code/deephaven.html#deephaven.doLocked">[docs]</a><span class="k">def</span> <span class="nf">doLocked</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">lock_type</span><span class="o">=</span><span class="s2">"shared"</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Executes a function while holding the UpdateGraphProcessor (UGP) lock.  Holding the UGP lock</span>
<span class="sd">    ensures that the contents of a table will not change during a computation, but holding</span>
<span class="sd">    the lock also prevents table updates from happening.  The lock should be held for as little</span>
<span class="sd">    time as possible.</span>

<span class="sd">    :param f: function to execute while holding the UGP lock.  f must be callable or have an apply attribute which is callable.</span>
<span class="sd">    :param lock_type: UGP lock type.  Valid values are "exclusive" and "shared".  "exclusive" allows only a single reader or writer to hold the lock.  "shared" allows multiple readers or a single writer to hold the lock.</span>
<span class="sd">    """</span>
    <span class="n">ThrowingRunnable</span> <span class="o">=</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.integrations.python.PythonThrowingRunnable"</span><span class="p">)</span>
    <span class="n">UpdateGraphProcessor</span> <span class="o">=</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"io.deephaven.engine.updategraph.UpdateGraphProcessor"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lock_type</span> <span class="o">==</span> <span class="s2">"exclusive"</span><span class="p">:</span>
        <span class="n">UpdateGraphProcessor</span><span class="o">.</span><span class="n">DEFAULT</span><span class="o">.</span><span class="n">exclusiveLock</span><span class="p">()</span><span class="o">.</span><span class="n">doLocked</span><span class="p">(</span><span class="n">ThrowingRunnable</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">lock_type</span> <span class="o">==</span> <span class="s2">"shared"</span><span class="p">:</span>
        <span class="n">UpdateGraphProcessor</span><span class="o">.</span><span class="n">DEFAULT</span><span class="o">.</span><span class="n">sharedLock</span><span class="p">()</span><span class="o">.</span><span class="n">doLocked</span><span class="p">(</span><span class="n">ThrowingRunnable</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unsupported lock type: lock_type=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lock_type</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">as_list</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Creates a Java list containing the values.</span>

<span class="sd">    :param values: values</span>
<span class="sd">    :return: Java list containing the values.</span>
<span class="sd">    """</span>
    <span class="n">_JArrayList</span> <span class="o">=</span> <span class="n">jpy</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">"java.util.ArrayList"</span><span class="p">)</span>
    <span class="n">j_list</span> <span class="o">=</span> <span class="n">_JArrayList</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">j_list</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j_list</span>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Deephaven Data Labs |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    </body>
</html>